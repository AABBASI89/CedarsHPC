function parloop_coherence(opt)
% This function initializes paths, sessions and computational power for 
% analysing cross-area coherence
% @AamirAbbasi
% Based on the functions provided by Jonathan from Rutishauser Lab. 
% Input:
%      - opt: option number, this option number defines the number of sessions 
%             you want to run on the high-performance cluster (HPC)
%% Go to the root folder on HPC where the code is located 
if isunix
  cd('/common/abbasim/code/');
  addpath(genpath('/common/abbasim/code'));
  addpath(genpath('/common/abbasim/eeglab'));
elseif ispc
  cd('C:/Users/AbbasiM/Documents/MATLAB/BMI_Analysis/');
  addpath(genpath('~/common/abbasim/code'));
  addpath(genpath('~/common/abbasim/eeglab'));  
end

% Options to run different sessions
if opt == 1
    whichsessions = 11;
elseif opt == 2
    whichsessions = 1:2;
elseif opt == 3
    whichsessions = 1:15;
elseif opt == 4
    whichsessions = 15:30;
end

% Define base folders and list of sessions
if ispc
    rootfolder = 'Z:/Aamir/BMI/';
else
    rootfolder = '/common/abbasim/data/';
end

bmiBlocks = {'I050/Data/I050-191218-112504/'...
            ,'I050/Data/I050-191218-130447/'...
            ,'I050/Data/I050-191219-105728/'...
            ,'I050/Data/I050-191219-141503/'...
            ,'I050/Data/I050-191220-104050/'...
            ,'I050/Data/I050-191220-135239/'...
            ,'I050/Data/I050-191221-121617/'...
            ,'I050/Data/I050-191221-141352/'...
            ,'I050/Data/I050-191223-133408/'...
            ,'I050/Data/I050-191223-160416/'...
            ,'I060/Data/I060-200310-112339/'...
            ,'I060/Data/I060-200310-143141/'...
            ,'I060/Data/I060-200311-114150/'...
            ,'I060/Data/I060-200311-140222/'...
            ,'I060/Data/I060-200312-111249/'...
            ,'I060/Data/I060-200312-134253/'...
            ,'I060/Data/I060-200313-113905/'...
            ,'I060/Data/I060-200313-142005/'...
            ,'I060/Data/I060-200314-131648/'...
            ,'I060/Data/I060-200314-160410/'...
            ,'I061/Data/I061-200505-131845/'...
            ,'I061/Data/I061-200505-144749/'...
            ,'I061/Data/I061-200506-110632/'...
            ,'I061/Data/I061-200506-142306/'...
            ,'I061/Data/I061-200507-111109/'...
            ,'I061/Data/I061-200507-131918/'...
            ,'I061/Data/I061-200508-120338/'...
            ,'I061/Data/I061-200508-142120/'...
            ,'I061/Data/I061-200509-122650/'...
	          ,'I061/Data/I061-200509-150451/'};


% Get session path in a concatanated list
for i=1:length(whichsessions)
  sessions{i} = [rootfolder,bmiBlocks{whichsessions(i)}];
end

% Parallel Loop! 
parpool('local',1);
threads = 4;
parfor s = 1:length(sessions)
  ffcEL_hpc(sessions{s},threads);
end
